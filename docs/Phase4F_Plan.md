# Phase 4F: Kaggle 실제 데이터를 활용한 라벨 품질 향상

## 개요
Phase 4F는 Phase 4E를 개선하여 더욱 엄격한 데이터 매칭 기준을 적용함으로써 라벨 정확도(85-90%)를 높이고, Risk 그룹과 Safe 그룹 간의 현실적인 사고율 비율을 유지합니다.

## 목표
1. **라벨 정확도 향상**: Phase 4E의 70-80%에서 85-90%로 향상
2. **현실적 사고 비율**: Risk 그룹 사고율 = Safe 그룹 사고율의 4배
3. **품질 우선**: 더 엄격한 매칭 기준으로 데이터 품질 향상
4. **실제 환경 검증**: 실제 Kaggle 샘플로 현실적 시나리오 테스트

## 데이터 매칭 기준

### 강화된 매칭 규칙
- **거리**: ≤ 50km (100km에서 감소)
  - Trade-off: 매칭률은 낮아지지만 매칭 품질 향상
  - 근거: 더 가까운 거리 = 더 유사한 도로 조건

- **시간**: ±3일 (±7일에서 감소)
  - Trade-off: 시간적으로 더 관련성 높은 기상 조건
  - 근거: 특히 겨울철에 기상 패턴이 빠르게 변화

- **도시**: 반드시 일치 (필수)
  - 지역적 일관성 보장

### 예상 결과
- **라벨 정확도**: 85-90% (목표)
- **사고율 비율**: Risk:Safe = 4:1
  - 실제 통계에서 3-5배 차이를 보이는 것에 기반
- **통합 데이터셋 크기**: 20,000 샘플 (목표)

### 데이터 품질 관리
- **오버샘플링 금지**: 각 bookingID는 최대 1회만 사용
- **샘플링 투명성**: 각 그룹의 샘플링 비율 문서화
- **균형 고려**: 합리적인 클래스 분포 유지

## 데이터 샘플 리포트 요구사항

데이터 샘플 리포트에 포함될 내용:

1. **데이터셋 개요**
   - 총 샘플 수: 20,000
   - 그룹별 분포 (Risk vs Safe)
   - 사고 결과별 분포

2. **실제 데이터 사례**
   - Risk 그룹 + 사고 발생
   - Risk 그룹 + 사고 미발생
   - Safe 그룹 + 사고 발생
   - Safe 그룹 + 사고 미발생
   - 포함 정보: 특징, 기상 조건, 예측값

3. **사고율 검증**
   - Risk 그룹 사고 건수
   - Safe 그룹 사고 건수
   - 4:1 비율 검증
   - 통계적 유의성 테스트

4. **데이터 품질 메트릭**
   - 매칭 성공률
   - 라벨 신뢰도 분포
   - 특징 완전성
   - 이상치 분석

## 모델 테스트

### 모델 1: 최적화된 로지스틱 회귀
- **기본 모델**: Logistic Regression
- **최적화 기법**:
  - 불균형 처리를 위한 클래스 가중치 조정
  - 최적 정밀도/재현율을 위한 임계값 튜닝
- **선택 이유**: 단순하고 해석 가능하며 확립된 기준선

### 모델 2: 보팅 앙상블
- **구성 모델**:
  - Logistic Regression (LR)
  - Random Forest (RF)
  - Gradient Boosting Machine (GBM)
- **보팅 전략**: Soft voting (확률 평균)
- **선택 이유**: 여러 알고리즘의 강점 결합

## 시나리오 테스트

### Scenario A: 정밀도 중심
**목표**: 거짓 양성 최소화 (불필요한 경고 감소)

**가중치**:
- Precision: 0.7
- Recall: 0.2
- F1-Score: 0.1

**사용 사례**: 사용자 신뢰 유지, 경고 피로 감소

**예상 동작**:
- 더 높은 분류 임계값
- 더 적지만 정확한 위험 경고
- 낮은 거짓 양성률

### Scenario B: 정밀도 중심
**목표**: 거짓 양성 최소화 (불필요한 경고 감소)

**가중치**:
- Precision: 0.7
- Recall: 0.2
- F1-Score: 0.1

**사용 사례**: 사용자 신뢰 유지, 경고 피로 감소

**예상 동작**:
- 더 높은 분류 임계값
- 더 적지만 정확한 위험 경고
- 낮은 거짓 양성률

### 시나리오 가중치 설명
가중치는 최적화 함수에서 각 메트릭의 중요도를 나타냅니다:
```
Score = (w_precision × Precision) + (w_recall × Recall) + (w_f1 × F1)
```

각 시나리오에 대해 다음을 보고합니다:
- 최적 임계값
- 혼동 행렬
- Precision, Recall, F1-Score
- ROC-AUC
- Risk 및 Safe 그룹 모두에 대한 분류 메트릭

## 이전 Phase와의 비교

### Phase 4D
- 합성 라벨
- 완전한 제어 가능하나 비현실적 패턴
- 기준 성능 메트릭

### Phase 4E
- 실제 Kaggle 샘플
- 느슨한 매칭 (100km, ±7일)
- 70-80% 라벨 정확도
- 초기 실제 환경 검증

### Phase 4F (현재)
- 실제 Kaggle 샘플
- 엄격한 매칭 (50km, ±3일)
- 85-90% 라벨 정확도 목표
- 4:1 사고 비율 (Risk:Safe)
- 더 높은 품질, 더 현실적

## 성공 기준

1. **데이터 품질**
   - 20,000개 통합 샘플 달성
   - 4:1 사고율 비율 검증
   - 라벨 정확도 85-90%
   - 오버샘플링 위반 없음

2. **모델 성능**
   - 두 모델 모두 AUC > 0.65 달성
   - 시나리오 간 의미 있는 성능 차이
   - Phase 4E 결과보다 우수

3. **산출물**
   - 완전한 계획 문서 (이 파일)
   - 실제 사례가 포함된 데이터 샘플 리포트
   - 두 시나리오에 대한 모델 테스트 결과
   - 최종 분석 리포트

## 일정

1. **1단계**: 데이터 추출 및 매칭 (1-2일)
2. **2단계**: 데이터 샘플 리포트 작성 (3일)
3. **3단계**: 모델 학습 및 테스트 (4-5일)
4. **4단계**: 최종 리포트 및 분석 (6일)

## 예상 도전과제

1. **낮은 매칭률**: 엄격한 기준으로 인해 매칭 수 감소 가능
2. **클래스 불균형**: 오버샘플링을 피하면서 4:1 비율 유지
3. **계산 비용**: 앙상블 모델은 더 많은 학습 시간 필요
4. **임계값 민감도**: 각 시나리오에 대한 최적 임계값 찾기

## 위험 완화

- 20K 목표 미달 시: 기준을 점진적으로 완화 (예: 60km, ±4일)
- 사고 비율 불균형 시: 샘플링 전략 조정
- 모델 성능 저조 시: 특징 엔지니어링 추가 또는 다른 모델 시도
- 모든 조정사항과 근거 문서화

---

**문서 버전**: 1.0
**날짜**: 2025-10-16
**상태**: 구현 준비 완료
